#
# Makefile.in for ircd/contrib
#
# $Id: Makefile.in,v 1.39 2003/05/12 23:43:33 joshk Exp $
#
CC		= @CC@
RM		= @RM@
SED		= @SED@
MV		= @MV@
LEX		= @LEX@
LEXLIB		= @LEXLIB@
CFLAGS		= @IRC_CFLAGS@
LN		= @LN@
PICFLAGS	= @PICFLAGS@
MKDEP		= @MKDEP@
INSTALL		= @INSTALL@
INSTALL_PROGRAM	= @INSTALL_PROGRAM@
INSTALL_DATA	= @INSTALL_DATA@
INSTALL_SUID    = @INSTALL_PROGRAM@ -o root -m 4755
AUTOMODULEDIR	= @prefix@/modules

SSL_LIBS	= @SSL_LIBS@
SSL_INCLUDES	= @SSL_INCLUDES@

IRCDLIBS	= @LIBS@ $(SSL_LIBS)

INCLUDES	= -I../include $(SSL_INCLUDES)
CPPFLAGS	= ${INCLUDES} @CPPFLAGS@

prefix=		@prefix@
uhelpdir=	${prefix}/help/users
ohelpdir=	${prefix}/help/opers

SYMLINKS=	topic accept cjoin cmode admin names links away whowas \
		version kick who invite quit join list nick oper part \
		time credits motd userhost users whois ison lusers \
		user help pass error challenge knock ping pong

SRCS =                          \
  m_clearchan.c			\
  m_flags.c                     \
  m_force.c			\
  m_help.c                      \
  m_jupe.c			\
  m_ltrace.c			\
  m_map.c			\
  m_killhost.c			\
  m_mkpasswd.c                  \
  m_ojoin.c			\
  m_operspy.c			\
  m_opme.c			\
  m_tburst.c			\
  m_whois.c			\
  spy_admin_notice.c		\
  spy_info_notice.c		\
  spy_links_notice.c		\
  spy_motd_notice.c		\
  spy_stats_notice.c            \
  spy_stats_p_notice.c		\
  spy_trace_notice.c		\
  spy_whois_notice.c            \
  example_module.c

OBJS = ${SRCS:.c=.so}

default:	build
build: all
all: $(OBJS)

install: all install_help
	@echo "Installing modules into $(AUTOMODULEDIR) .."
	@for file in $(OBJS); do \
		$(INSTALL_DATA) $$file $(AUTOMODULEDIR); \
	done


install_help:
	@echo installing help files...
	mkdir -p $(ohelpdir) $(uhelpdir)
	@for help in help/opers/*; do \
	if [ -f $$help ]; then \
		${INSTALL_DATA} $$help $(ohelpdir); \
	fi \
	done
	@for help in help/users/*; do \
	if [ -f $$help ]; then \
		$(INSTALL_DATA) $$help $(uhelpdir); \
	fi \
	done
	@for link in $(SYMLINKS); do \
		${RM} -f $(uhelpdir)/$$link; \
		${LN} -s $(ohelpdir)/$$link $(uhelpdir); \
	done

.SUFFIXES: .so

.c.so:
	${CC} ${PICFLAGS}  ${CPPFLAGS} ${CFLAGS} $< -o $@

.PHONY: depend clean distclean
depend:
	@${MKDEP} ${CPPFLAGS} ${SRCS} > .depend
	@${SED} s/\\\.o/\\\.so/ < .depend > .depend.tmp
	@${SED} -e '/^# DO NOT DELETE THIS LINE/,$$d' <Makefile >Makefile.depend
	@echo '# DO NOT DELETE THIS LINE!!!' >>Makefile.depend
	@echo '# make depend needs it.' >>Makefile.depend
	@cat .depend.tmp >>Makefile.depend
	@${MV} Makefile.depend Makefile
	@${RM} -f .depend.tmp .depend

clean:
	${RM} -f *.so *~ 

distclean: clean
	${RM} -f Makefile

